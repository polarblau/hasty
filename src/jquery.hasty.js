// Generated by CoffeeScript 1.3.1
(function() {
  var $;

  $ = jQuery;

  $.fn.hasty = function(options) {
    var defaultTemplate, render, settings;
    settings = $.extend({
      perPage: 10
    });
    defaultTemplate = "<ul>\n  {{#comments}}\n    <li>\n      <span class='author'>\n        <img src='{{user.avatar_url}}' alt='Gravatar' />\n        <strong>{{user.login}}</strong>\n        said:\n      </span>\n      <span class='date'>{{created_at}}</span>\n      <span class='body'>{{body}}</span>\n    </li>\n  {{/comments}}\n</ul>";
    render = function(comments, $container) {
      var output;
      console.log(comments);
      output = Mustache.render(defaultTemplate, {
        comments: comments
      });
      return $container.html(output);
    };
    return this.each(function() {
      var $this, comments, commitCommentsURL, commitIDs, commitsURL, loadAndRender;
      $this = $(this);
      commitsURL = $this.data('commits-url');
      commitIDs = $this.data('commit-ids');
      comments = [];
      commitCommentsURL = function(commitID) {
        return "" + commitsURL + "/" + commitID + "/comments";
      };
      loadAndRender = function() {
        var commitID;
        if (!(commitIDs.length <= 0)) {
          commitID = commitIDs.shift();
          return $.ajax({
            url: commitCommentsURL(commitID),
            success: function(response) {
              comments.concat(response.data);
              if (comments.length < settings.perPage) {
                loadAndRender();
              }
              return render(comments, $this);
            },
            dataType: 'jsonp'
          });
        }
      };
      return loadAndRender();
    });
  };

}).call(this);
